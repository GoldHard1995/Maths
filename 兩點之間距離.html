<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åæ¨™è·é›¢å­¸ç¿’éŠæˆ²</title>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®š Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Segoe UI', 'Microsoft JhengHei', 'sans-serif'],
                    },
                    animation: {
                        'bounce-short': 'bounce 0.5s ease-in-out 2',
                        'spin-slow': 'spin 3s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–æ¨™çµ„ä»¶ (Inline SVGs to replace Lucide) ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Target = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>;
        const ArrowLeft = (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const Home = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;

        // --- ä¸»éŠæˆ²çµ„ä»¶ ---
        const CoordinateGame = () => {
            // Game State
            const [level, setLevel] = useState(null); // 1 or 2
            const [score, setScore] = useState(0);
            const [questionCount, setQuestionCount] = useState(1);
            const [gameState, setGameState] = useState('menu'); // menu, playing, result
            
            // Question State
            const [targetPoints, setTargetPoints] = useState([]);
            const [plottedPoints, setPlottedPoints] = useState([]);
            const [step, setStep] = useState('menu'); // plotting_A, plotting_B, answering, feedback
            const [userAnswer, setUserAnswer] = useState('');
            const [feedbackMsg, setFeedbackMsg] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [attempts, setAttempts] = useState(0); // Track wrong attempts for Level 2

            // Canvas Refs
            const canvasRef = useRef(null);
            // UPDATE: Adjusted grid size and canvas size for 8x8 range (16 units total)
            const gridSize = 25; // pixels per unit (Total 16 units * 25px = 400px)
            const canvasSize = 400; // 400x400 pixels
            const center = canvasSize / 2;

            // Configuration Helper
            const getMaxQuestions = () => {
                return level === 2 ? 10 : 5;
            };

            // --- Logic Helpers ---

            const getRandomInt = (min, max) => {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            };

            const generateQuestion = (selectedLevel) => {
                // Determine axis alignment (0 for vertical, 1 for horizontal)
                const axis = Math.random() > 0.5 ? 'x' : 'y';
                // UPDATE: Increased range for random numbers to utilize -8 to 8 space
                const fixedVal = getRandomInt(-6, 6); 
                
                let p1, p2;
                
                // Ensure points are not the same and fit in new canvas size
                let val1 = getRandomInt(-7, 7);
                let val2 = getRandomInt(-7, 7);
                while (val1 === val2 || Math.abs(val1 - val2) < 2) { 
                val2 = getRandomInt(-7, 7);
                }

                // Sort so calculation logic is consistent visually if needed
                const v1 = Math.min(val1, val2);
                const v2 = Math.max(val1, val2);

                if (axis === 'x') {
                    // Vertical line: x is constant
                    p1 = { x: fixedVal, y: v1, label: 'A' };
                    p2 = { x: fixedVal, y: v2, label: 'B' };
                } else {
                    // Horizontal line: y is constant
                    p1 = { x: v1, y: fixedVal, label: 'A' };
                    p2 = { x: v2, y: fixedVal, label: 'B' };
                }

                setTargetPoints([p1, p2]);
                setPlottedPoints([]);
                setUserAnswer('');
                setFeedbackMsg('');
                setIsCorrect(null);
                setAttempts(0); // Reset attempts
                
                if (selectedLevel === 1) {
                    setStep('plotting_A');
                } else {
                    setStep('answering');
                }
            };

            const startGame = (lvl) => {
                setLevel(lvl);
                setScore(0);
                setQuestionCount(1);
                setGameState('playing');
                generateQuestion(lvl);
            };

            const handleNextQuestion = () => {
                if (questionCount >= getMaxQuestions()) {
                    setGameState('result');
                } else {
                    setQuestionCount(prev => prev + 1);
                    generateQuestion(level);
                }
            };

            const returnToMenu = () => {
                setGameState('menu');
                setLevel(null);
                setStep('menu');
            };

            // --- Interaction Logic ---

            const handleCanvasClick = (e) => {
                // Only allow clicking in Level 1 during plotting phases
                if (level !== 1 || (step !== 'plotting_A' && step !== 'plotting_B')) return;

                const canvas = canvasRef.current;
                if (!canvas) return;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Scale coordinates if canvas is resized by CSS
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;

                const canvasX = x * scaleX;
                const canvasY = y * scaleY;

                // Convert to grid coordinates
                const gridX = Math.round((canvasX - center) / gridSize);
                const gridY = Math.round((center - canvasY) / gridSize); // Invert Y

                const clickedPoint = { x: gridX, y: gridY, label: step === 'plotting_A' ? 'A' : 'B' };

                // Target point to match
                const target = step === 'plotting_A' ? targetPoints[0] : targetPoints[1];

                if (clickedPoint.x === target.x && clickedPoint.y === target.y) {
                    // Correct point clicked
                    setPlottedPoints([...plottedPoints, clickedPoint]);
                    
                    if (step === 'plotting_A') {
                        setStep('plotting_B');
                    } else {
                        setStep('answering');
                    }
                } else {
                    setFeedbackMsg(`ä½ç½®ä¸å°å–”ï¼ä½ é»åˆ°äº† (${clickedPoint.x}, ${clickedPoint.y})`);
                    setIsCorrect(false);
                    setTimeout(() => {
                        setFeedbackMsg('');
                        setIsCorrect(null);
                    }, 1500);
                }
            };

            const handleNumPadClick = (num) => {
                if (step === 'feedback') return;
                setUserAnswer(prev => prev + num);
            };

            const handleNumPadDelete = () => {
                if (step === 'feedback') return;
                setUserAnswer(prev => prev.slice(0, -1));
            };

            const checkAnswer = () => {
                if (!userAnswer) return;

                const p1 = targetPoints[0];
                const p2 = targetPoints[1];
                
                // Calculate distance
                const dist = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
                const inputVal = parseFloat(userAnswer);

                if (Math.abs(inputVal - dist) < 0.01) {
                    // Correct
                    const addedScore = level === 2 && attempts > 0 ? 10 : 20; // Half points if hints used
                    setScore(prev => prev + addedScore);
                    setFeedbackMsg(`ç­”å°äº†ï¼è·é›¢æ˜¯ ${dist}`);
                    setIsCorrect(true);
                    setStep('feedback');
                } else {
                    // Incorrect
                    setUserAnswer(''); // é¡Œç›®éŒ¯äº†å¾Œï¼Œç›´æ¥é‡ç½®ç­”æ¡ˆ

                    if (level === 2) {
                        const newAttempts = attempts + 1;
                        setAttempts(newAttempts);

                        // Calculate values for hint
                        const isVertical = p1.x === p2.x;
                        const v1 = isVertical ? p1.y : p1.x;
                        const v2 = isVertical ? p2.y : p2.x;
                        
                        // Find Max and Min for "Big - Small"
                        const maxVal = Math.max(v1, v2);
                        const minVal = Math.min(v1, v2);
                        const minValStr = minVal < 0 ? `(${minVal})` : `${minVal}`; // Add parenthesis for negative numbers

                        if (newAttempts === 1) {
                            // First mistake: Calculation Hint using Big - Small
                            const hintText = `æç¤ºï¼šåˆ©ç”¨ã€Œå¤§æ¸›ç´°ã€ï¼š${maxVal} - ${minValStr} = ?`;
                            setFeedbackMsg(hintText);
                            setIsCorrect(false);
                        } else {
                            // Second mistake: Show Full Formula and Answer
                            const formula = `${maxVal} - ${minValStr}`;
                            
                            setFeedbackMsg(`é‚„æ˜¯ä¸å°ã€‚å…¬å¼ï¼š${formula} = ${dist}`);
                            setIsCorrect(false);
                            setStep('feedback');
                        }
                    } else {
                        // Level 1: Immediate failure feedback (simple mode)
                        setFeedbackMsg(`ç­”æ¡ˆä¸å°ã€‚æ­£ç¢ºè·é›¢æ˜¯ ${dist}`);
                        setIsCorrect(false);
                        setStep('feedback');
                    }
                }
            };

            // --- Drawing Logic ---
            
            useEffect(() => {
                // Only draw canvas for Level 1
                if (level !== 1) return;

                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.clearRect(0, 0, canvasSize, canvasSize);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvasSize, canvasSize);

                // Draw Grid
                ctx.beginPath();
                ctx.strokeStyle = '#cbd5e1'; // slate-300 (Darker for better visibility)
                ctx.lineWidth = 1;

                for (let i = 0; i <= canvasSize; i += gridSize) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvasSize);
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvasSize, i);
                }
                ctx.stroke();

                // Draw Axes
                ctx.beginPath();
                ctx.strokeStyle = '#334155'; // slate-700
                ctx.lineWidth = 2;
                ctx.moveTo(center, 0);
                ctx.lineTo(center, canvasSize);
                ctx.moveTo(0, center);
                ctx.lineTo(canvasSize, center);
                ctx.stroke();

                // Draw Labels
                ctx.font = 'bold 14px Arial'; // Increased font weight and size
                ctx.fillStyle = '#0047AB'; // Strong Blue (Cobalt Blue)
                ctx.fillText('y', center + 6, 14);
                ctx.fillText('x', canvasSize - 14, center - 6);
                ctx.fillText('0', center + 4, center + 18);

                // Draw Numbers
                ctx.font = 'bold 12px Arial'; // Bold for better readability
                
                // UPDATE: Loop from -8 to 8 for the new 8x8 range
                for (let i = -8; i <= 8; i++) {
                    if (i === 0) continue;
                    ctx.fillText(i, center + i * gridSize - 4, center + 16); // X axis numbers
                    ctx.fillText(i, center + 6, center - i * gridSize + 4); // Y axis numbers
                }

                // Draw Points Logic (Level 1 only)
                plottedPoints.forEach(p => drawPoint(ctx, p, '#3b82f6')); 

                if (step === 'feedback') {
                    targetPoints.forEach(p => drawPoint(ctx, p, '#22c55e')); // Green
                    
                    // Draw dashed line
                    ctx.beginPath();
                    ctx.strokeStyle = '#f59e0b'; // Amber
                    ctx.lineWidth = 3;
                    ctx.setLineDash([6, 6]);
                    const tp1 = targetPoints[0];
                    const tp2 = targetPoints[1];
                    ctx.moveTo(center + tp1.x * gridSize, center - tp1.y * gridSize);
                    ctx.lineTo(center + tp2.x * gridSize, center - tp2.y * gridSize);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

            }, [plottedPoints, step, targetPoints, level, gameState, attempts]);

            const drawPoint = (ctx, point, color) => {
                const cx = center + point.x * gridSize;
                const cy = center - point.y * gridSize;
                
                ctx.beginPath();
                ctx.arc(cx, cy, 6, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                
                ctx.fillStyle = '#1e293b';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`${point.label}`, cx + 8, cy - 8);
            };

            // --- Components ---

            const Numpad = () => (
                <div className="grid grid-cols-3 gap-2 mt-auto">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                        <button 
                        key={num} 
                        onClick={() => handleNumPadClick(num.toString())}
                        className="bg-white/10 hover:bg-white/20 active:bg-white/30 text-white font-bold py-2 md:py-3 rounded-lg transition-colors border border-white/10 shadow-sm text-lg"
                        >
                        {num}
                        </button>
                    ))}
                    <button 
                        onClick={() => handleNumPadClick('0')}
                        className="col-span-2 bg-white/10 hover:bg-white/20 active:bg-white/30 text-white font-bold py-2 md:py-3 rounded-lg transition-colors border border-white/10 shadow-sm text-lg"
                    >
                        0
                    </button>
                    <button 
                        onClick={handleNumPadDelete}
                        className="bg-rose-500/80 hover:bg-rose-600 active:bg-rose-700 text-white font-bold py-2 md:py-3 rounded-lg transition-colors shadow-sm"
                    >
                        âŒ«
                    </button>
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white font-sans selection:bg-purple-500 selection:text-white flex flex-col items-center justify-center p-2 md:p-4">
                
                {/* --- MENU SCREEN --- */}
                {gameState === 'menu' && (
                    <div className="max-w-2xl w-full mx-auto animate-fade-in p-4">
                    <div className="text-center mb-8">
                        <h1 className="text-3xl md:text-5xl font-bold text-white mb-2 tracking-tight drop-shadow-lg">
                        ğŸ“ åæ¨™è·é›¢å­¸ç¿’
                        </h1>
                        <p className="text-purple-200 text-base md:text-lg">ç·´ç¿’åœ¨åæ¨™å¹³é¢ä¸Šè¨ˆç®—é»èˆ‡é»ä¹‹é–“çš„è·é›¢</p>
                    </div>
                    
                    <div className="space-y-4">
                        <button 
                        onClick={() => startGame(1)}
                        className="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white p-5 rounded-2xl shadow-xl transform transition-all hover:scale-[1.01] group"
                        >
                        <div className="flex items-center justify-center gap-4 md:gap-6">
                            <span className="text-4xl md:text-5xl group-hover:scale-110 transition-transform">ğŸ¯</span>
                            <div className="text-left">
                            <div className="text-xl md:text-2xl font-bold mb-1">ç¨‹åº¦ 1ï¼šæ•¸æ ¼å­</div>
                            <div className="text-emerald-100 text-sm md:text-base">å…ˆé»å‡ºä½ç½®ï¼Œå†æ•¸æ ¼å­</div>
                            </div>
                        </div>
                        </button>
                        
                        <button 
                        onClick={() => startGame(2)}
                        className="w-full bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-400 hover:to-rose-400 text-white p-5 rounded-2xl shadow-xl transform transition-all hover:scale-[1.01] group"
                        >
                        <div className="flex items-center justify-center gap-4 md:gap-6">
                            <span className="text-4xl md:text-5xl group-hover:scale-110 transition-transform">ğŸ§®</span>
                            <div className="text-left">
                            <div className="text-xl md:text-2xl font-bold mb-1">ç¨‹åº¦ 2ï¼šç›´æ¥è¨ˆç®—</div>
                            <div className="text-orange-100 text-sm md:text-base">10 é¡ŒæŒ‘æˆ°ï¼šçœ‹åæ¨™ï¼Œç”¨ã€Œå¤§æ¸›ç´°ã€ç®—è·é›¢</div>
                            </div>
                        </div>
                        </button>
                    </div>
                    </div>
                )}

                {/* --- GAME SCREEN --- */}
                {gameState === 'playing' && (
                    <div className="w-full max-w-5xl mx-auto animate-fade-in flex flex-col h-full md:h-auto justify-center">
                    
                    {/* Top Bar - Compact */}
                    <div className="flex justify-between items-center mb-4 gap-2 px-1">
                        <button 
                        onClick={returnToMenu}
                        className="bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors flex items-center gap-2 text-xs md:text-sm font-medium backdrop-blur-sm"
                        >
                        <ArrowLeft className="w-4 h-4" /> è¿”å›
                        </button>
                        
                        <div className="flex items-center gap-2 text-xs md:text-sm">
                        <div className="bg-emerald-500/20 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-emerald-500/30 text-emerald-200">
                            <span className="opacity-70 mr-1">åˆ†</span>
                            <span className="font-bold text-emerald-400">{score}</span>
                        </div>
                        <div className="bg-purple-500/20 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-purple-500/30 text-purple-200">
                            <span className="opacity-70 mr-1">é¡Œ</span>
                            <span className="font-bold text-purple-300">{questionCount}/{getMaxQuestions()}</span>
                        </div>
                        </div>
                    </div>

                    {/* Question Hint/Title */}
                    <div className="bg-white/10 backdrop-blur-md border border-white/10 rounded-xl p-3 mb-4 text-center shadow-lg mx-1">
                        <div className="text-lg md:text-xl font-medium">
                            {step === 'plotting_A' && <span>é»å‡º <span className="font-bold text-rose-400">é» A ({targetPoints[0]?.x}, {targetPoints[0]?.y})</span></span>}
                            {step === 'plotting_B' && <span>é»å‡º <span className="font-bold text-blue-400">é» B ({targetPoints[1]?.x}, {targetPoints[1]?.y})</span></span>}
                            {(step === 'answering' || step === 'feedback') && <span>è¨ˆç®— A èˆ‡ B çš„è·é›¢</span>}
                        </div>
                    </div>

                    {/* Main Layout: Responsive Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-[1fr_280px] lg:grid-cols-[1fr_320px] gap-4 md:gap-6 items-start">
                        
                        {/* Left Column: Visuals */}
                        <div className="flex flex-col items-center justify-center min-h-0">
                        
                        {/* LEVEL 1: Canvas Visual */}
                        {level === 1 && (
                            <div className="bg-white rounded-xl p-1 shadow-2xl overflow-hidden inline-block">
                            <canvas 
                                ref={canvasRef}
                                width={canvasSize}
                                height={canvasSize}
                                onClick={handleCanvasClick}
                                className="w-full h-auto cursor-crosshair touch-none max-h-[50vh] md:max-h-none object-contain"
                                style={{ maxWidth: '400px' }} 
                            />
                            </div>
                        )}

                        {/* LEVEL 2: Large Cards Visual (No Canvas) */}
                        {level === 2 && (
                            <div className="flex flex-col gap-6 w-full max-w-[400px] justify-center py-8">
                                <div className="w-full bg-rose-500/90 backdrop-blur rounded-2xl p-6 text-center shadow-lg transform transition-transform hover:scale-105">
                                    <div className="text-sm text-rose-100 mb-2 font-bold uppercase tracking-wider">é» A åæ¨™</div>
                                    <div className="text-5xl font-bold font-mono text-white drop-shadow-md">
                                        ({targetPoints[0]?.x}, {targetPoints[0]?.y})
                                    </div>
                                </div>
                                
                                <div className="w-full bg-blue-500/90 backdrop-blur rounded-2xl p-6 text-center shadow-lg transform transition-transform hover:scale-105">
                                    <div className="text-sm text-blue-100 mb-2 font-bold uppercase tracking-wider">é» B åæ¨™</div>
                                    <div className="text-5xl font-bold font-mono text-white drop-shadow-md">
                                        ({targetPoints[1]?.x}, {targetPoints[1]?.y})
                                    </div>
                                </div>
                            </div>
                        )}

                        </div>

                        {/* Right Column: Interaction Panel */}
                        <div className="flex flex-col gap-3 w-full md:w-auto h-full">
                        
                        <div className="bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl p-4 flex flex-col shadow-xl">
                            
                            {/* Input Display */}
                            <div className="mb-3">
                                {step === 'plotting_A' || step === 'plotting_B' ? (
                                    <div className="text-white/60 py-4 flex flex-col items-center text-sm">
                                        <Target className="w-8 h-8 mb-2 opacity-50 animate-pulse" />
                                        <span>è«‹å…ˆåœ¨åœ°åœ–ä¸Šæ¨™è¨˜é»...</span>
                                    </div>
                                ) : (
                                    <div>
                                        <div className="flex gap-2">
                                            <div className="flex-1 bg-black/20 rounded-xl border-2 border-white/10 h-12 flex items-center justify-center text-2xl font-bold tracking-widest font-mono">
                                                {userAnswer}
                                                <span className="w-0.5 h-5 bg-purple-400 ml-1 animate-pulse"></span>
                                            </div>
                                            <button 
                                                onClick={checkAnswer}
                                                disabled={step === 'feedback' || !userAnswer}
                                                className="bg-purple-500 hover:bg-purple-600 disabled:bg-gray-600 disabled:opacity-50 text-white font-bold px-4 rounded-xl transition-colors text-sm"
                                            >
                                                ç¢ºèª
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Feedback Message Area */}
                            <div className="min-h-[60px] flex items-center justify-center text-center mb-2 px-1">
                                {feedbackMsg && (
                                    <div className={`flex flex-col items-center gap-1 ${isCorrect === false ? 'text-rose-300' : 'text-emerald-300'} font-bold text-sm md:text-base animate-bounce-short`}>
                                    <div className="flex items-center gap-2">
                                        {isCorrect ? <CheckCircle className="w-5 h-5" /> : <XCircle className="w-5 h-5" />}
                                        <span>{feedbackMsg.split('å…¬å¼')[0].split('æç¤º')[0]}</span>
                                    </div>
                                    {/* Show formula on new line if exists */}
                                    {feedbackMsg.includes('å…¬å¼') && (
                                        <div className="text-base bg-black/30 px-3 py-1 rounded text-white/90 font-mono mt-1">
                                            {feedbackMsg.split('å…¬å¼')[1]}
                                        </div>
                                    )}
                                    {/* Show hint formula on new line */}
                                    {feedbackMsg.includes('æç¤ºï¼š') && (
                                        <div className="text-base bg-black/30 px-3 py-1 rounded text-yellow-300 font-mono mt-1">
                                            {feedbackMsg.split('æç¤ºï¼š')[1]}
                                        </div>
                                    )}
                                    </div>
                                )}
                            </div>

                            {/* Keypad or Next Button */}
                            {step === 'feedback' ? (
                                <button 
                                    onClick={handleNextQuestion}
                                    className="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-3 rounded-xl text-lg flex items-center justify-center gap-2 shadow-lg transition-all mt-auto"
                                >
                                    <RefreshCw className={`w-5 h-5 ${questionCount < getMaxQuestions() ? "animate-spin-slow" : ""}`} />
                                    {questionCount >= getMaxQuestions() ? "æŸ¥çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ"}
                                </button>
                            ) : (
                                <div className={`mt-auto ${step === 'plotting_A' || step === 'plotting_B' ? 'opacity-30 pointer-events-none grayscale' : ''}`}>
                                    <Numpad />
                                </div>
                            )}
                        </div>
                        </div>

                    </div>
                    </div>
                )}

                {/* --- RESULT SCREEN --- */}
                {gameState === 'result' && (
                    <div className="max-w-md w-full mx-auto text-center animate-fade-in p-4">
                    <div className="bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl p-8 shadow-2xl">
                        <div className="text-6xl mb-4 filter drop-shadow-lg">
                            {score >= (getMaxQuestions() * 20 * 0.8) ? 'ğŸ†' : score >= (getMaxQuestions() * 20 * 0.6) ? 'ğŸ‰' : 'ğŸ’ª'}
                        </div>
                        <h2 className="text-2xl md:text-3xl font-bold text-white mb-2">æŒ‘æˆ°å®Œæˆï¼</h2>
                        <div className="text-purple-200 mb-6">
                            ç¨‹åº¦ {level} â€¢ ç¸½å…± {getMaxQuestions()} é¡Œ
                        </div>
                        
                        <div className="bg-black/20 rounded-2xl p-4 mb-6 border border-white/5">
                            <div className="text-sm text-white/60 mb-1">æœ€çµ‚å¾—åˆ†</div>
                            <div className={`text-5xl font-bold ${score >= (getMaxQuestions() * 20 * 0.8) ? 'text-yellow-400' : 'text-emerald-400'} font-mono`}>
                                {score}
                            </div>
                        </div>

                        <div className="space-y-3">
                            <button 
                                onClick={() => startGame(level)}
                                className="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-emerald-500/20"
                            >
                                <RotateCcw className="w-5 h-5" /> å†ç©ä¸€æ¬¡
                            </button>
                            <button 
                                onClick={returnToMenu}
                                className="w-full bg-white/10 hover:bg-white/20 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all"
                            >
                                <Home className="w-5 h-5" /> è¿”å›é¸å–®
                            </button>
                        </div>
                    </div>
                    </div>
                )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CoordinateGame />);
    </script>
</body>
</html>
