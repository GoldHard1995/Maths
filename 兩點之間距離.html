<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åæ¨™è·é›¢å­¸ç¿’éŠæˆ²</title>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¨­å®š Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Segoe UI', 'Microsoft JhengHei', 'sans-serif'],
                    },
                    animation: {
                        'bounce-short': 'bounce 0.5s ease-in-out 2',
                        'spin-slow': 'spin 3s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–æ¨™çµ„ä»¶ (Inline SVGs) ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Target = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>;
        const ArrowLeft = (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const XCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const Home = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const ArrowUpDown = (props) => <Icon {...props}><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/></Icon>;
        const ArrowLeftRight = (props) => <Icon {...props}><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></Icon>; 
        
        // --- ä¸»éŠæˆ²çµ„ä»¶ ---
        const CoordinateGame = () => {
            // Game State
            const [level, setLevel] = useState(null); // 1 or 2
            const [score, setScore] = useState(0);
            const [questionCount, setQuestionCount] = useState(1);
            const [gameState, setGameState] = useState('menu'); // menu, playing, result
            
            // Question State
            const [targetPoints, setTargetPoints] = useState([]);
            const [plottedPoints, setPlottedPoints] = useState([]);
            // Step: plotting_A -> plotting_B -> judging -> answering -> feedback
            const [step, setStep] = useState('menu'); 
            const [userAnswer, setUserAnswer] = useState('');
            const [feedbackMsg, setFeedbackMsg] = useState('');
            const [isCorrect, setIsCorrect] = useState(null);
            const [attempts, setAttempts] = useState(0); 

            // Canvas Refs
            const canvasRef = useRef(null);
            const gridSize = 25; // pixels per unit 
            const canvasSize = 400; // 400x400 pixels
            const center = canvasSize / 2;

            // Configuration Helper
            const getMaxQuestions = () => {
                return level === 2 ? 10 : 5;
            };

            // --- Logic Helpers ---

            const getRandomInt = (min, max) => {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            };

            const generateQuestion = (selectedLevel) => {
                
                // Determine axis alignment (0 for vertical, 1 for horizontal)
                const axis = Math.random() > 0.5 ? 'x' : 'y';
                
                // è¨­å®šéš¨æ©Ÿç¯„åœï¼š
                // ç¨‹åº¦ 1ï¼šå›ºå®šåœ¨ -7 åˆ° 7 (åŸæœ¬æ˜¯ -8 åˆ° 8)
                // ç¨‹åº¦ 2ï¼šæ“´å¤§è‡³ -15 åˆ° 15
                const rangeLimit = selectedLevel === 2 ? 15 : 7;
                
                const fixedVal = getRandomInt(-rangeLimit, rangeLimit); 
                
                let val1 = getRandomInt(-rangeLimit, rangeLimit);
                let val2 = getRandomInt(-rangeLimit, rangeLimit);
                
                // ç¢ºä¿å…©é»ä¸é‡ç–Šä¸”è·é›¢è‡³å°‘ç‚º 2
                while (val1 === val2 || Math.abs(val1 - val2) < 2) { 
                    val2 = getRandomInt(-rangeLimit, rangeLimit);
                }

                // æ’åºæ•¸å€¼
                const v1 = Math.min(val1, val2);
                const v2 = Math.max(val1, val2);

                let p1, p2;
                if (axis === 'x') {
                    // Vertical line: x is constant
                    p1 = { x: fixedVal, y: v1, label: 'A' };
                    p2 = { x: fixedVal, y: v2, label: 'B' };
                } else {
                    // Horizontal line: y is constant
                    p1 = { x: v1, y: fixedVal, label: 'A' };
                    p2 = { x: v2, y: fixedVal, label: 'B' };
                }

                setTargetPoints([p1, p2]);
                setPlottedPoints([]);
                setUserAnswer('');
                setFeedbackMsg('');
                setIsCorrect(null);
                setAttempts(0); 
                
                // è¨­å®šåˆå§‹æ­¥é©Ÿ
                if (selectedLevel === 1) {
                    setStep('plotting_A');
                } else {
                    setStep('judging'); // ç¨‹åº¦ 2 ç›´æ¥é–‹å§‹åˆ¤æ–·
                }
            };

            const startGame = (lvl) => {
                setLevel(lvl);
                setScore(0);
                setQuestionCount(1);
                setGameState('playing');
                generateQuestion(lvl);
            };

            const handleNextQuestion = () => {
                if (questionCount >= getMaxQuestions()) {
                    setGameState('result');
                } else {
                    setQuestionCount(prev => prev + 1);
                    generateQuestion(level);
                }
            };

            const returnToMenu = () => {
                setGameState('menu');
                setLevel(null);
                setStep('menu');
            };

            // --- Interaction Logic ---

            const handleCanvasClick = (e) => {
                if (level !== 1 || (step !== 'plotting_A' && step !== 'plotting_B')) return;

                const canvas = canvasRef.current;
                if (!canvas) return;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;

                const canvasX = x * scaleX;
                const canvasY = y * scaleY;

                const gridX = Math.round((canvasX - center) / gridSize);
                const gridY = Math.round((center - canvasY) / gridSize); 

                const clickedPoint = { x: gridX, y: gridY, label: step === 'plotting_A' ? 'A' : 'B' };
                const target = step === 'plotting_A' ? targetPoints[0] : targetPoints[1];

                if (clickedPoint.x === target.x && clickedPoint.y === target.y) {
                    setPlottedPoints([...plottedPoints, clickedPoint]);
                    setFeedbackMsg('');
                    setIsCorrect(null);

                    if (step === 'plotting_A') {
                        setStep('plotting_B');
                    } else {
                        // é»å®Œ B é»å¾Œï¼Œé€²å…¥åˆ¤æ–·é¡Œéšæ®µ
                        setStep('judging');
                    }
                } else {
                    setFeedbackMsg(`ä½ç½®ä¸å°å–”ï¼ä½ é»åˆ°äº† (${clickedPoint.x}, ${clickedPoint.y})`);
                    setIsCorrect(false);
                    setTimeout(() => {
                        setFeedbackMsg('');
                        setIsCorrect(null);
                    }, 1500);
                }
            };

            const handleNumPadClick = (num) => {
                if (step === 'feedback') return;
                setUserAnswer(prev => prev + num);
            };

            const handleNumPadDelete = () => {
                if (step === 'feedback') return;
                setUserAnswer(prev => prev.slice(0, -1));
            };

            // åˆ¤æ–·ç·šå‹é¡Œç›® - æª¢æŸ¥ç­”æ¡ˆ
            const checkOrientation = (selectedType) => {
                const p1 = targetPoints[0];
                const p2 = targetPoints[1];
                const isVertical = p1.x === p2.x;
                const correctType = isVertical ? 'vertical' : 'horizontal';
                
                if (selectedType === correctType) {
                    // Correct
                    const addedScore = 5; // åˆ¤æ–·æ­£ç¢ºå¾— 5 åˆ†
                    setScore(prev => prev + addedScore);
                    setFeedbackMsg(`åˆ¤æ–·æ­£ç¢ºï¼é€™æ˜¯ä¸€æ¢${isVertical ? 'é‰›å‚ç·š' : 'æ°´å¹³ç·š'}ã€‚ç¾åœ¨è«‹è¨ˆç®—è·é›¢ã€‚`);
                    setIsCorrect(true);
                    
                    // é€²å…¥ä¸‹ä¸€éšæ®µï¼šè¨ˆç®—è·é›¢
                    setStep('answering');
                    setAttempts(0); // é‡ç½®è¨ˆç®—é¡Œçš„å˜—è©¦æ¬¡æ•¸
                    
                    // 3ç§’å¾Œæ¸…é™¤æ­£ç¢ºæç¤ºï¼Œä»¥å…å¹²æ“¾ä½œç­”ï¼Œæˆ–è€…ä¿ç•™åœ¨ä¸Šæ–¹
                    // é€™è£¡é¸æ“‡ä¿ç•™ feedbackMsg è®“å­¸ç”ŸçŸ¥é“ä¸Šä¸€éƒ¨åšå°äº†
                } else {
                    // Incorrect
                    setFeedbackMsg(`ç­”éŒ¯äº†ã€‚${isVertical ? 'x åæ¨™ç›¸åŒï¼Œæ‰€ä»¥æ˜¯é‰›å‚ç·š' : 'y åæ¨™ç›¸åŒï¼Œæ‰€ä»¥æ˜¯æ°´å¹³ç·š'}ã€‚å†è©¦ä¸€æ¬¡ï¼`);
                    setIsCorrect(false);
                    // ä¸åˆ‡æ›æ­¥é©Ÿï¼Œè®“å­¸ç”Ÿé‡é¸
                }
            };

            // è¨ˆç®—è·é›¢é¡Œç›® - æª¢æŸ¥ç­”æ¡ˆ
            const checkDistance = () => {
                if (!userAnswer) return;

                const p1 = targetPoints[0];
                const p2 = targetPoints[1];
                const dist = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
                const inputVal = parseFloat(userAnswer);

                if (Math.abs(inputVal - dist) < 0.01) {
                    // è¨ˆç®—é¡Œçµ¦ 15 åˆ† (åŠ ä¸Šåˆ¤æ–·é¡Œçš„ 5 åˆ†ï¼Œç¸½å…± 20 åˆ†/é¡Œ)
                    // å¦‚æœæœ‰ç”¨éæç¤º (attempts > 0)ï¼Œåˆ†æ•¸æ¸›åŠ
                    const addedScore = attempts > 0 ? 8 : 15; 
                    setScore(prev => prev + addedScore);
                    setFeedbackMsg(`ç­”å°äº†ï¼è·é›¢æ˜¯ ${dist}`);
                    setIsCorrect(true);
                    setStep('feedback');
                } else {
                    setUserAnswer(''); 

                    if (level === 2) {
                        const newAttempts = attempts + 1;
                        setAttempts(newAttempts);

                        const isVertical = p1.x === p2.x;
                        const v1 = isVertical ? p1.y : p1.x;
                        const v2 = isVertical ? p2.y : p2.x;
                        
                        const maxVal = Math.max(v1, v2);
                        const minVal = Math.min(v1, v2);
                        const minValStr = minVal < 0 ? `(${minVal})` : `${minVal}`;

                        if (newAttempts === 1) {
                            const hintText = `æç¤ºï¼šåˆ©ç”¨ã€Œå¤§æ¸›ç´°ã€ï¼š${maxVal} - ${minValStr} = ?`;
                            setFeedbackMsg(hintText);
                            setIsCorrect(false);
                        } else {
                            const formula = `${maxVal} - ${minValStr}`;
                            setFeedbackMsg(`é‚„æ˜¯ä¸å°ã€‚å…¬å¼ï¼š${formula} = ${dist}`);
                            setIsCorrect(false);
                            setStep('feedback');
                        }
                    } else {
                        setFeedbackMsg(`ç­”æ¡ˆä¸å°ã€‚æ­£ç¢ºè·é›¢æ˜¯ ${dist}`);
                        setIsCorrect(false);
                        setStep('feedback');
                    }
                }
            };

            // --- Drawing Logic ---
            useEffect(() => {
                if (level !== 1) return;

                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');

                ctx.clearRect(0, 0, canvasSize, canvasSize);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvasSize, canvasSize);

                ctx.beginPath();
                ctx.strokeStyle = '#cbd5e1'; 
                ctx.lineWidth = 1;

                for (let i = 0; i <= canvasSize; i += gridSize) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvasSize);
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvasSize, i);
                }
                ctx.stroke();

                ctx.beginPath();
                ctx.strokeStyle = '#334155'; 
                ctx.lineWidth = 2;
                ctx.moveTo(center, 0);
                ctx.lineTo(center, canvasSize);
                ctx.moveTo(0, center);
                ctx.lineTo(canvasSize, center);
                ctx.stroke();

                ctx.font = 'bold 14px Arial'; 
                ctx.fillStyle = '#0047AB'; 
                ctx.fillText('y', center + 6, 14);
                ctx.fillText('x', canvasSize - 14, center - 6);
                ctx.fillText('0', center + 4, center + 18);

                ctx.font = 'bold 12px Arial'; 
                
                for (let i = -8; i <= 8; i++) {
                    if (i === 0) continue;
                    ctx.fillText(i, center + i * gridSize - 4, center + 16); 
                    ctx.fillText(i, center + 6, center - i * gridSize + 4); 
                }

                plottedPoints.forEach(p => drawPoint(ctx, p, '#3b82f6')); 

                // åœ¨åˆ¤æ–·éšæ®µã€å›ç­”éšæ®µã€æˆ–å›é¥‹éšæ®µï¼Œå¦‚æœæ˜¯åœ¨ Level 1 éƒ½è¦æŠŠé»ç•«å‡ºä¾†
                if (step === 'judging' || step === 'answering' || step === 'feedback') {
                     // ç¢ºä¿å¦‚æœæœ‰ plottedPoints å°±ç•«å‡ºä¾†ï¼Œå¦‚æœæ²’æœ‰(ä¾‹å¦‚å‰›é€²å…¥)å‰‡é¡¯ç¤º
                     // Level 1: å·²ç¶“ plot å®Œäº†ï¼Œæ‰€ä»¥ plottedPoints æ‡‰è©²æœ‰å€¼
                     // ä½†å¦‚æœæ˜¯ answering/feedbackï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç•«å‡ºç›®æ¨™é»(ç¶ è‰²)
                }

                if (step === 'feedback' || (level === 1 && plottedPoints.length === 2)) {
                    // Draw dashed line connecting points
                    ctx.beginPath();
                    ctx.strokeStyle = '#f59e0b'; // Amber
                    ctx.lineWidth = 3;
                    ctx.setLineDash([6, 6]);
                    
                    // Use plotted points for user feedback, or target points for final result
                    const p1 = plottedPoints.length === 2 ? plottedPoints[0] : targetPoints[0];
                    const p2 = plottedPoints.length === 2 ? plottedPoints[1] : targetPoints[1];
                    
                    if(p1 && p2) {
                        ctx.moveTo(center + p1.x * gridSize, center - p1.y * gridSize);
                        ctx.lineTo(center + p2.x * gridSize, center - p2.y * gridSize);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }
                }
                
                if (step === 'feedback') {
                    targetPoints.forEach(p => drawPoint(ctx, p, '#22c55e')); // Green
                }

            }, [plottedPoints, step, targetPoints, level, gameState, attempts]);

            const drawPoint = (ctx, point, color) => {
                const cx = center + point.x * gridSize;
                const cy = center - point.y * gridSize;
                
                ctx.beginPath();
                ctx.arc(cx, cy, 6, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                
                ctx.fillStyle = '#1e293b';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`${point.label}`, cx + 8, cy - 8);
            };

            // --- Components ---

            const Numpad = () => (
                <div className="grid grid-cols-3 gap-2 mt-auto">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                        <button 
                        key={num} 
                        onClick={() => handleNumPadClick(num.toString())}
                        className="bg-white/10 hover:bg-white/20 active:bg-white/30 text-white font-bold py-2 md:py-3 rounded-lg transition-colors border border-white/10 shadow-sm text-lg"
                        >
                        {num}
                        </button>
                    ))}
                    <button 
                        onClick={() => handleNumPadClick('0')}
                        className="col-span-2 bg-white/10 hover:bg-white/20 active:bg-white/30 text-white font-bold py-2 md:py-3 rounded-lg transition-colors border border-white/10 shadow-sm text-lg"
                    >
                        0
                    </button>
                    <button 
                        onClick={handleNumPadDelete}
                        className="bg-rose-500/80 hover:bg-rose-600 active:bg-rose-700 text-white font-bold py-2 md:py-3 rounded-lg transition-colors shadow-sm"
                    >
                        âŒ«
                    </button>
                </div>
            );

            // æ–¹å‘é¸æ“‡æŒ‰éˆ•çµ„ä»¶
            const OrientationSelector = () => (
                <div className="flex flex-col gap-3 mt-auto h-full justify-center">
                    <button 
                        onClick={() => checkOrientation('horizontal')}
                        className="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-xl text-xl flex flex-col items-center justify-center gap-2 transition-all shadow-lg active:scale-95"
                    >
                        <div className="flex items-center gap-2">
                             <ArrowLeftRight className="w-8 h-8" />
                             <span>æ°´å¹³ç·š (Horizontal)</span>
                        </div>
                        <span className="text-sm opacity-80 font-normal">y åæ¨™ç›¸åŒ</span>
                    </button>
                    <button 
                        onClick={() => checkOrientation('vertical')}
                        className="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-bold py-4 rounded-xl text-xl flex flex-col items-center justify-center gap-2 transition-all shadow-lg active:scale-95"
                    >
                        <div className="flex items-center gap-2">
                            <ArrowUpDown className="w-8 h-8" />
                            <span>é‰›å‚ç·š (Vertical)</span>
                        </div>
                        <span className="text-sm opacity-80 font-normal">x åæ¨™ç›¸åŒ</span>
                    </button>
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white font-sans selection:bg-purple-500 selection:text-white flex flex-col items-center justify-center p-2 md:p-4">
                
                {gameState === 'menu' && (
                    <div className="max-w-2xl w-full mx-auto animate-fade-in p-4">
                    <div className="text-center mb-8">
                        <h1 className="text-3xl md:text-5xl font-bold text-white mb-2 tracking-tight drop-shadow-lg">
                        ğŸ“ åæ¨™è·é›¢å­¸ç¿’
                        </h1>
                        <p className="text-purple-200 text-base md:text-lg">ç·´ç¿’åœ¨åæ¨™å¹³é¢ä¸Šè¨ˆç®—é»èˆ‡é»ä¹‹é–“çš„è·é›¢</p>
                    </div>
                    
                    <div className="space-y-4">
                        <button 
                        onClick={() => startGame(1)}
                        className="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white p-5 rounded-2xl shadow-xl transform transition-all hover:scale-[1.01] group"
                        >
                        <div className="flex items-center justify-center gap-4 md:gap-6">
                            <span className="text-4xl md:text-5xl group-hover:scale-110 transition-transform">ğŸ¯</span>
                            <div className="text-left">
                            <div className="text-xl md:text-2xl font-bold mb-1">ç¨‹åº¦ 1ï¼šæ•¸æ ¼å­</div>
                            <div className="text-emerald-100 text-sm md:text-base">ç¯„åœ -7~7ï¼Œè¦–è¦ºè¼”åŠ©</div>
                            </div>
                        </div>
                        </button>
                        
                        <button 
                        onClick={() => startGame(2)}
                        className="w-full bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-400 hover:to-rose-400 text-white p-5 rounded-2xl shadow-xl transform transition-all hover:scale-[1.01] group"
                        >
                        <div className="flex items-center justify-center gap-4 md:gap-6">
                            <span className="text-4xl md:text-5xl group-hover:scale-110 transition-transform">ğŸ§®</span>
                            <div className="text-left">
                            <div className="text-xl md:text-2xl font-bold mb-1">ç¨‹åº¦ 2ï¼šç›´æ¥è¨ˆç®—</div>
                            <div className="text-orange-100 text-sm md:text-base">10 é¡ŒæŒ‘æˆ° (ç¯„åœ -15~15)</div>
                            </div>
                        </div>
                        </button>
                    </div>
                    </div>
                )}

                {gameState === 'playing' && (
                    <div className="w-full max-w-5xl mx-auto animate-fade-in flex flex-col h-full md:h-auto justify-center">
                    
                    <div className="flex justify-between items-center mb-4 gap-2 px-1">
                        <button 
                        onClick={returnToMenu}
                        className="bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg transition-colors flex items-center gap-2 text-xs md:text-sm font-medium backdrop-blur-sm"
                        >
                        <ArrowLeft className="w-4 h-4" /> è¿”å›
                        </button>
                        
                        <div className="flex items-center gap-2 text-xs md:text-sm">
                        <div className="bg-emerald-500/20 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-emerald-500/30 text-emerald-200">
                            <span className="opacity-70 mr-1">åˆ†</span>
                            <span className="font-bold text-emerald-400">{score}</span>
                        </div>
                        <div className="bg-purple-500/20 px-3 py-1.5 rounded-lg backdrop-blur-sm border border-purple-500/30 text-purple-200">
                            <span className="opacity-70 mr-1">é¡Œ</span>
                            <span className="font-bold text-purple-300">{questionCount}/{getMaxQuestions()}</span>
                        </div>
                        </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-md border border-white/10 rounded-xl p-3 mb-4 text-center shadow-lg mx-1">
                        <div className="text-lg md:text-xl font-medium">
                            {step === 'plotting_A' && <span>é»å‡º <span className="font-bold text-rose-400">é» A ({targetPoints[0]?.x}, {targetPoints[0]?.y})</span></span>}
                            {step === 'plotting_B' && <span>é»å‡º <span className="font-bold text-blue-400">é» B ({targetPoints[1]?.x}, {targetPoints[1]?.y})</span></span>}
                            {step === 'judging' && <span className="text-yellow-300 font-bold">æ­¥é©Ÿ 1ï¼šè«‹å•ç·šæ®µ AB æ˜¯æ°´å¹³ç·šé‚„æ˜¯é‰›å‚ç·šï¼Ÿ</span>}
                            {(step === 'answering' || step === 'feedback') && <span>æ­¥é©Ÿ 2ï¼šè¨ˆç®— A èˆ‡ B çš„è·é›¢</span>}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-[1fr_280px] lg:grid-cols-[1fr_320px] gap-4 md:gap-6 items-start">
                        
                        <div className="flex flex-col items-center justify-center min-h-0">
                        
                        {/* LEVEL 1: Canvas Visual */}
                        {level === 1 && (
                            <div className="bg-white rounded-xl p-1 shadow-2xl overflow-hidden inline-block">
                            <canvas 
                                ref={canvasRef}
                                width={canvasSize}
                                height={canvasSize}
                                onClick={handleCanvasClick}
                                className="w-full h-auto cursor-crosshair touch-none max-h-[50vh] md:max-h-none object-contain"
                                style={{ maxWidth: '400px' }} 
                            />
                            </div>
                        )}

                        {/* LEVEL 2: Large Cards Visual */}
                        {level === 2 && (
                            <div className="flex flex-col gap-6 w-full max-w-[400px] justify-center py-8">
                                <div className="w-full bg-rose-500/90 backdrop-blur rounded-2xl p-6 text-center shadow-lg transform transition-transform hover:scale-105">
                                    <div className="text-sm text-rose-100 mb-2 font-bold uppercase tracking-wider">é» A åæ¨™</div>
                                    <div className="text-5xl font-bold font-mono text-white drop-shadow-md">
                                        ({targetPoints[0]?.x}, {targetPoints[0]?.y})
                                    </div>
                                </div>
                                
                                <div className="w-full bg-blue-500/90 backdrop-blur rounded-2xl p-6 text-center shadow-lg transform transition-transform hover:scale-105">
                                    <div className="text-sm text-blue-100 mb-2 font-bold uppercase tracking-wider">é» B åæ¨™</div>
                                    <div className="text-5xl font-bold font-mono text-white drop-shadow-md">
                                        ({targetPoints[1]?.x}, {targetPoints[1]?.y})
                                    </div>
                                </div>
                            </div>
                        )}

                        </div>

                        {/* Right Column: Interaction Panel */}
                        <div className="flex flex-col gap-3 w-full md:w-auto h-full min-h-[400px] md:min-h-0">
                        
                        <div className="bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl p-4 flex flex-col shadow-xl h-full">
                            
                            {/* Input Display (Only for distance questions) */}
                            {step === 'answering' || step === 'feedback' ? (
                                <div className="mb-3">
                                    {step === 'plotting_A' || step === 'plotting_B' ? (
                                        <div className="text-white/60 py-4 flex flex-col items-center text-sm">
                                            <Target className="w-8 h-8 mb-2 opacity-50 animate-pulse" />
                                            <span>è«‹å…ˆåœ¨åœ°åœ–ä¸Šæ¨™è¨˜é»...</span>
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="flex gap-2">
                                                <div className="flex-1 bg-black/20 rounded-xl border-2 border-white/10 h-12 flex items-center justify-center text-2xl font-bold tracking-widest font-mono">
                                                    {userAnswer}
                                                    <span className="w-0.5 h-5 bg-purple-400 ml-1 animate-pulse"></span>
                                                </div>
                                                <button 
                                                    onClick={checkDistance}
                                                    disabled={step === 'feedback' || !userAnswer}
                                                    className="bg-purple-500 hover:bg-purple-600 disabled:bg-gray-600 disabled:opacity-50 text-white font-bold px-4 rounded-xl transition-colors text-sm"
                                                >
                                                    ç¢ºèª
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ) : null}

                            {/* Feedback Message Area */}
                            <div className="min-h-[60px] flex items-center justify-center text-center mb-2 px-1">
                                {feedbackMsg && (
                                    <div className={`flex flex-col items-center gap-1 ${isCorrect === false ? 'text-rose-300' : 'text-emerald-300'} font-bold text-sm md:text-base animate-bounce-short`}>
                                    <div className="flex items-center gap-2">
                                        {isCorrect ? <CheckCircle className="w-5 h-5" /> : <XCircle className="w-5 h-5" />}
                                        <span>{feedbackMsg.split('å…¬å¼')[0].split('æç¤º')[0].split('ã€‚')[0]}</span>
                                    </div>
                                    {/* Show extra details */}
                                    {feedbackMsg.includes('ã€‚') && !feedbackMsg.includes('å…¬å¼') && !feedbackMsg.includes('æç¤º') && (
                                         <div className="text-sm opacity-90">{feedbackMsg.split('ã€‚')[1]}</div>
                                    )}
                                    {/* Show formula on new line if exists */}
                                    {feedbackMsg.includes('å…¬å¼') && (
                                        <div className="text-base bg-black/30 px-3 py-1 rounded text-white/90 font-mono mt-1">
                                            {feedbackMsg.split('å…¬å¼')[1]}
                                        </div>
                                    )}
                                    {/* Show hint formula on new line */}
                                    {feedbackMsg.includes('æç¤ºï¼š') && (
                                        <div className="text-base bg-black/30 px-3 py-1 rounded text-yellow-300 font-mono mt-1">
                                            {feedbackMsg.split('æç¤ºï¼š')[1]}
                                        </div>
                                    )}
                                    </div>
                                )}
                            </div>

                            {/* Controls: Next Button OR Keypad OR Orientation Select */}
                            {step === 'feedback' ? (
                                <button 
                                    onClick={handleNextQuestion}
                                    className="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-3 rounded-xl text-lg flex items-center justify-center gap-2 shadow-lg transition-all mt-auto"
                                >
                                    <RefreshCw className={`w-5 h-5 ${questionCount < getMaxQuestions() ? "animate-spin-slow" : ""}`} />
                                    {questionCount >= getMaxQuestions() ? "æŸ¥çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ"}
                                </button>
                            ) : (
                                <div className={`mt-auto h-full flex flex-col ${step === 'plotting_A' || step === 'plotting_B' ? 'opacity-30 pointer-events-none grayscale' : ''}`}>
                                    {step === 'judging' ? (
                                        <OrientationSelector />
                                    ) : (
                                        <Numpad />
                                    )}
                                </div>
                            )}
                        </div>
                        </div>

                    </div>
                    </div>
                )}

                {gameState === 'result' && (
                    <div className="max-w-md w-full mx-auto text-center animate-fade-in p-4">
                    <div className="bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl p-8 shadow-2xl">
                        <div className="text-6xl mb-4 filter drop-shadow-lg">
                            {score >= (getMaxQuestions() * 20 * 0.8) ? 'ğŸ†' : score >= (getMaxQuestions() * 20 * 0.6) ? 'ğŸ‰' : 'ğŸ’ª'}
                        </div>
                        <h2 className="text-2xl md:text-3xl font-bold text-white mb-2">æŒ‘æˆ°å®Œæˆï¼</h2>
                        <div className="text-purple-200 mb-6">
                            ç¨‹åº¦ {level} â€¢ ç¸½å…± {getMaxQuestions()} é¡Œ
                        </div>
                        
                        <div className="bg-black/20 rounded-2xl p-4 mb-6 border border-white/5">
                            <div className="text-sm text-white/60 mb-1">æœ€çµ‚å¾—åˆ†</div>
                            <div className={`text-5xl font-bold ${score >= (getMaxQuestions() * 20 * 0.8) ? 'text-yellow-400' : 'text-emerald-400'} font-mono`}>
                                {score}
                            </div>
                        </div>

                        <div className="space-y-3">
                            <button 
                                onClick={() => startGame(level)}
                                className="w-full bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-emerald-500/20"
                            >
                                <RotateCcw className="w-5 h-5" /> å†ç©ä¸€æ¬¡
                            </button>
                            <button 
                                onClick={returnToMenu}
                                className="w-full bg-white/10 hover:bg-white/20 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all"
                            >
                                <Home className="w-5 h-5" /> è¿”å›é¸å–®
                            </button>
                        </div>
                    </div>
                    </div>
                )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CoordinateGame />);
    </script>
</body>
</html>
